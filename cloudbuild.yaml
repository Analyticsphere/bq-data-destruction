steps:
  - name: "gcr.io/google.com/cloudsdktool/cloud-sdk:slim"
    entrypoint: "bash"
    args:
      - "-c"
      - |
          # Install jq
          apt-get update && apt-get install -y jq
          
          # Create the scheduled query transfer configuration.
          bq mk \
            --transfer_config \
            --display_name="bq_data_destruction" \
            --params="$(jq -n --rawfile query bq_data_destruction.sql '{query: $query}')" \
            --data_source=scheduled_query \
            --start_time="$(date -u +%Y-%m-%dT%H:%M:%SZ)" \
            --schedule='every day 01:30' \
            --location=US \
            --service_account_name="$SERVICE_ACCOUNT_EMAIL"
options:
  logging: CLOUD_LOGGING_ONLY
